<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LPO API 종합 테스트 - 모든 기능 검증</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        .header h1 {
            color: #2c3e50;
            margin: 0;
            font-size: 2.5em;
        }
        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
            margin: 10px 0 0 0;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .test-section {
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            padding: 20px;
            background: #f8f9fa;
        }
        .test-section h3 {
            color: #2c3e50;
            margin: 0 0 15px 0;
            font-size: 1.3em;
        }
        .test-button { 
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 25px; 
            cursor: pointer; 
            margin: 5px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        .test-button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        .test-button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .result { 
            margin: 15px 0; 
            padding: 15px; 
            border-radius: 8px; 
            border-left: 4px solid;
        }
        .success { 
            background: #d4edda; 
            border-color: #28a745; 
            color: #155724; 
        }
        .error { 
            background: #f8d7da; 
            border-color: #dc3545; 
            color: #721c24; 
        }
        .loading {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        pre { 
            background: #2c3e50; 
            color: #ecf0f1;
            padding: 15px; 
            border-radius: 8px; 
            overflow-x: auto; 
            font-size: 0.9em;
            margin: 10px 0;
        }
        .status-bar {
            background: #34495e;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
        .summary {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .summary h3 {
            color: #28a745;
            margin: 0 0 15px 0;
        }
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .test-item:last-child {
            border-bottom: none;
        }
        .test-name {
            font-weight: 600;
        }
        .test-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 600;
        }
        .status-pass { background: #d4edda; color: #155724; }
        .status-fail { background: #f8d7da; color: #721c24; }
        .status-pending { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔍 LPO API 종합 테스트</h1>
            <p>MOSB Gate Agent의 모든 LPO 관련 기능을 검증합니다</p>
        </div>

        <div class="status-bar">
            <div>서버 상태: <span id="serverStatus">확인 중...</span></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div>진행률: <span id="progressText">0%</span></div>
        </div>

        <div class="test-grid">
            <div class="test-section">
                <h3>🌐 기본 연결 테스트</h3>
                <button class="test-button" onclick="testBasicConnection()">서버 연결 확인</button>
                <button class="test-button" onclick="testAPIHealth()">API 헬스체크</button>
                <div id="basicResult"></div>
            </div>

            <div class="test-section">
                <h3>📍 LPO 위치 조회</h3>
                <button class="test-button" onclick="testValidLPO()">유효한 LPO 조회</button>
                <button class="test-button" onclick="testInvalidLPO()">존재하지 않는 LPO</button>
                <button class="test-button" onclick="testWrongFormat()">잘못된 형식</button>
                <div id="lpoResult"></div>
            </div>

            <div class="test-section">
                <h3>📋 MOSB 신청서</h3>
                <button class="test-button" onclick="testApplicationSubmit()">신청서 제출</button>
                <button class="test-button" onclick="testApplicationList()">신청서 목록</button>
                <button class="test-button" onclick="testApplicationStatus()">상태 조회</button>
                <div id="applicationResult"></div>
            </div>

            <div class="test-section">
                <h3>🔧 고급 기능</h3>
                <button class="test-button" onclick="testBatchLPO()">배치 LPO 조회</button>
                <button class="test-button" onclick="testStatistics()">통계 정보</button>
                <button class="test-button" onclick="testErrorHandling()">에러 처리</button>
                <div id="advancedResult"></div>
            </div>
        </div>

        <div class="summary" id="summary" style="display: none;">
            <h3>📊 테스트 결과 요약</h3>
            <div id="summaryContent"></div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="test-button" onclick="runAllTests()" style="font-size: 1.2em; padding: 15px 30px;">
                🚀 모든 테스트 실행
            </button>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';
        let testResults = {};
        let currentTest = 0;
        const totalTests = 12;

        // 서버 상태 확인
        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_BASE}/test-lpo`);
                if (response.ok) {
                    document.getElementById('serverStatus').textContent = '✅ 연결됨 (포트 3001)';
                    document.getElementById('serverStatus').style.color = '#28a745';
                } else {
                    document.getElementById('serverStatus').textContent = '❌ 연결 실패';
                    document.getElementById('serverStatus').style.color = '#dc3545';
                }
            } catch (error) {
                document.getElementById('serverStatus').textContent = '❌ 서버 오프라인';
                document.getElementById('serverStatus').style.color = '#dc3545';
            }
        }

        // 진행률 업데이트
        function updateProgress() {
            currentTest++;
            const percentage = Math.round((currentTest / totalTests) * 100);
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = percentage + '%';
        }

        // 결과 표시
        function showResult(containerId, success, title, data) {
            const container = document.getElementById(containerId);
            container.className = `result ${success ? 'success' : 'error'}`;
            container.innerHTML = `
                <h4>${success ? '✅' : '❌'} ${title}</h4>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            updateProgress();
        }

        // 기본 연결 테스트
        async function testBasicConnection() {
            try {
                const response = await fetch(`${API_BASE}/test-lpo`);
                const data = await response.json();
                
                if (response.ok) {
                    showResult('basicResult', true, '서버 연결 성공', data);
                    testResults.basicConnection = 'PASS';
                } else {
                    showResult('basicResult', false, '서버 연결 실패', data);
                    testResults.basicConnection = 'FAIL';
                }
            } catch (error) {
                showResult('basicResult', false, '네트워크 오류', { error: error.message });
                testResults.basicConnection = 'FAIL';
            }
        }

        // API 헬스체크
        async function testAPIHealth() {
            try {
                const response = await fetch(`${API_BASE}/test-lpo`);
                const data = await response.json();
                
                if (response.ok && data.message) {
                    showResult('basicResult', true, 'API 헬스체크 성공', data);
                    testResults.apiHealth = 'PASS';
                } else {
                    showResult('basicResult', false, 'API 헬스체크 실패', data);
                    testResults.apiHealth = 'FAIL';
                }
            } catch (error) {
                showResult('basicResult', false, 'API 헬스체크 오류', { error: error.message });
                testResults.apiHealth = 'FAIL';
            }
        }

        // 유효한 LPO 조회
        async function testValidLPO() {
            try {
                const response = await fetch(`${API_BASE}/lpo/location/LPO-2024-001234`);
                const data = await response.json();
                
                if (response.ok && data.lpoNumber) {
                    showResult('lpoResult', true, '유효한 LPO 조회 성공', data);
                    testResults.validLPO = 'PASS';
                } else {
                    showResult('lpoResult', false, '유효한 LPO 조회 실패', data);
                    testResults.validLPO = 'FAIL';
                }
            } catch (error) {
                showResult('lpoResult', false, 'LPO 조회 오류', { error: error.message });
                testResults.validLPO = 'FAIL';
            }
        }

        // 존재하지 않는 LPO 조회
        async function testInvalidLPO() {
            try {
                const response = await fetch(`${API_BASE}/lpo/location/LPO-2024-999999`);
                const data = await response.json();
                
                if (response.status === 404) {
                    showResult('lpoResult', true, '존재하지 않는 LPO - 올바른 404 응답', data);
                    testResults.invalidLPO = 'PASS';
                } else {
                    showResult('lpoResult', false, '존재하지 않는 LPO - 예상과 다른 응답', data);
                    testResults.invalidLPO = 'FAIL';
                }
            } catch (error) {
                showResult('lpoResult', false, 'LPO 조회 오류', { error: error.message });
                testResults.invalidLPO = 'FAIL';
            }
        }

        // 잘못된 형식 테스트
        async function testWrongFormat() {
            try {
                const response = await fetch(`${API_BASE}/lpo/location/INVALID-FORMAT`);
                const data = await response.json();
                
                if (response.status === 400) {
                    showResult('lpoResult', true, '잘못된 형식 - 올바른 400 응답', data);
                    testResults.wrongFormat = 'PASS';
                } else {
                    showResult('lpoResult', false, '잘못된 형식 - 예상과 다른 응답', data);
                    testResults.wrongFormat = 'FAIL';
                }
            } catch (error) {
                showResult('lpoResult', false, '형식 검증 오류', { error: error.message });
                testResults.wrongFormat = 'FAIL';
            }
        }

        // 신청서 제출 테스트
        async function testApplicationSubmit() {
            try {
                const testApplication = {
                    driverName: "테스트 운전자",
                    phone: "+971-50-123-4567",
                    company: "테스트 회사",
                    visitDate: "2024-12-25",
                    vehicleType: "트럭",
                    documents: []
                };

                const response = await fetch(`${API_BASE}/mosb/applications`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testApplication)
                });
                
                const data = await response.json();
                
                if (response.ok && data.application) {
                    showResult('applicationResult', true, '신청서 제출 성공', data);
                    testResults.applicationSubmit = 'PASS';
                } else {
                    showResult('applicationResult', false, '신청서 제출 실패', data);
                    testResults.applicationSubmit = 'FAIL';
                }
            } catch (error) {
                showResult('applicationResult', false, '신청서 제출 오류', { error: error.message });
                testResults.applicationSubmit = 'FAIL';
            }
        }

        // 신청서 목록 조회
        async function testApplicationList() {
            try {
                const response = await fetch(`${API_BASE}/mosb/applications`);
                const data = await response.json();
                
                if (response.ok) {
                    showResult('applicationResult', true, '신청서 목록 조회 성공', data);
                    testResults.applicationList = 'PASS';
                } else {
                    showResult('applicationResult', false, '신청서 목록 조회 실패', data);
                    testResults.applicationList = 'FAIL';
                }
            } catch (error) {
                showResult('applicationResult', false, '신청서 목록 조회 오류', { error: error.message });
                testResults.applicationList = 'FAIL';
            }
        }

        // 신청서 상태 조회
        async function testApplicationStatus() {
            try {
                const response = await fetch(`${API_BASE}/mosb/applications/MSB-2024-001234`);
                const data = await response.json();
                
                if (response.ok || response.status === 404) {
                    showResult('applicationResult', true, '신청서 상태 조회 성공', data);
                    testResults.applicationStatus = 'PASS';
                } else {
                    showResult('applicationResult', false, '신청서 상태 조회 실패', data);
                    testResults.applicationStatus = 'FAIL';
                }
            } catch (error) {
                showResult('applicationResult', false, '신청서 상태 조회 오류', { error: error.message });
                testResults.applicationStatus = 'FAIL';
            }
        }

        // 배치 LPO 조회
        async function testBatchLPO() {
            try {
                const lpoNumbers = ['LPO-2024-001234', 'LPO-2024-001235', 'LPO-2024-999999'];
                const results = {};
                
                for (const lpoNumber of lpoNumbers) {
                    try {
                        const response = await fetch(`${API_BASE}/lpo/location/${lpoNumber}`);
                        const data = await response.json();
                        results[lpoNumber] = response.ok ? data : { error: data.error };
                    } catch (error) {
                        results[lpoNumber] = { error: error.message };
                    }
                }
                
                showResult('advancedResult', true, '배치 LPO 조회 완료', results);
                testResults.batchLPO = 'PASS';
            } catch (error) {
                showResult('advancedResult', false, '배치 LPO 조회 오류', { error: error.message });
                testResults.batchLPO = 'FAIL';
            }
        }

        // 통계 정보 조회
        async function testStatistics() {
            try {
                const response = await fetch(`${API_BASE}/mosb/applications`);
                const data = await response.json();
                
                if (response.ok) {
                    const applications = data.applications || [];
                    const stats = {
                        totalApplications: applications.length,
                        pendingApplications: applications.filter(app => app.status === 'submitted').length,
                        approvedApplications: applications.filter(app => app.status === 'approved').length,
                        rejectedApplications: applications.filter(app => app.status === 'rejected').length
                    };
                    
                    showResult('advancedResult', true, '통계 정보 조회 성공', stats);
                    testResults.statistics = 'PASS';
                } else {
                    showResult('advancedResult', false, '통계 정보 조회 실패', data);
                    testResults.statistics = 'FAIL';
                }
            } catch (error) {
                showResult('advancedResult', false, '통계 정보 조회 오류', { error: error.message });
                testResults.statistics = 'FAIL';
            }
        }

        // 에러 처리 테스트
        async function testErrorHandling() {
            try {
                // 잘못된 엔드포인트 테스트
                const response = await fetch(`${API_BASE}/invalid-endpoint`);
                
                if (response.status === 404) {
                    showResult('advancedResult', true, '에러 처리 테스트 성공', { 
                        message: '잘못된 엔드포인트에 대한 올바른 404 응답',
                        status: response.status 
                    });
                    testResults.errorHandling = 'PASS';
                } else {
                    showResult('advancedResult', false, '에러 처리 테스트 실패', { 
                        message: '예상과 다른 응답',
                        status: response.status 
                    });
                    testResults.errorHandling = 'FAIL';
                }
            } catch (error) {
                showResult('advancedResult', true, '에러 처리 테스트 성공', { 
                    message: '네트워크 오류에 대한 적절한 처리',
                    error: error.message 
                });
                testResults.errorHandling = 'PASS';
            }
        }

        // 모든 테스트 실행
        async function runAllTests() {
            currentTest = 0;
            testResults = {};
            
            // 진행률 초기화
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('progressText').textContent = '0%';
            
            // 모든 테스트 순차 실행
            await testBasicConnection();
            await testAPIHealth();
            await testValidLPO();
            await testInvalidLPO();
            await testWrongFormat();
            await testApplicationSubmit();
            await testApplicationList();
            await testApplicationStatus();
            await testBatchLPO();
            await testStatistics();
            await testErrorHandling();
            
            // 결과 요약 표시
            showSummary();
        }

        // 결과 요약 표시
        function showSummary() {
            const summary = document.getElementById('summary');
            const content = document.getElementById('summaryContent');
            
            const passedTests = Object.values(testResults).filter(result => result === 'PASS').length;
            const totalTests = Object.keys(testResults).length;
            const successRate = Math.round((passedTests / totalTests) * 100);
            
            let summaryHTML = `
                <div style="margin-bottom: 20px;">
                    <h4>전체 결과: ${passedTests}/${totalTests} 테스트 통과 (${successRate}%)</h4>
                </div>
            `;
            
            for (const [testName, result] of Object.entries(testResults)) {
                const statusClass = result === 'PASS' ? 'status-pass' : 'status-fail';
                const statusText = result === 'PASS' ? '통과' : '실패';
                
                summaryHTML += `
                    <div class="test-item">
                        <span class="test-name">${getTestDisplayName(testName)}</span>
                        <span class="test-status ${statusClass}">${statusText}</span>
                    </div>
                `;
            }
            
            content.innerHTML = summaryHTML;
            summary.style.display = 'block';
        }

        // 테스트 이름 변환
        function getTestDisplayName(testName) {
            const names = {
                'basicConnection': '서버 연결',
                'apiHealth': 'API 헬스체크',
                'validLPO': '유효한 LPO 조회',
                'invalidLPO': '존재하지 않는 LPO',
                'wrongFormat': '잘못된 형식 검증',
                'applicationSubmit': '신청서 제출',
                'applicationList': '신청서 목록',
                'applicationStatus': '신청서 상태',
                'batchLPO': '배치 LPO 조회',
                'statistics': '통계 정보',
                'errorHandling': '에러 처리'
            };
            return names[testName] || testName;
        }

        // 페이지 로드 시 서버 상태 확인
        window.onload = function() {
            checkServerStatus();
        };
    </script>
</body>
</html> 