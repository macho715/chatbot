<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LPO API ì¢…í•© í…ŒìŠ¤íŠ¸ - ëª¨ë“  ê¸°ëŠ¥ ê²€ì¦</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        .header h1 {
            color: #2c3e50;
            margin: 0;
            font-size: 2.5em;
        }
        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
            margin: 10px 0 0 0;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .test-section {
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            padding: 20px;
            background: #f8f9fa;
        }
        .test-section h3 {
            color: #2c3e50;
            margin: 0 0 15px 0;
            font-size: 1.3em;
        }
        .test-button { 
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 25px; 
            cursor: pointer; 
            margin: 5px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        .test-button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        .test-button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .result { 
            margin: 15px 0; 
            padding: 15px; 
            border-radius: 8px; 
            border-left: 4px solid;
        }
        .success { 
            background: #d4edda; 
            border-color: #28a745; 
            color: #155724; 
        }
        .error { 
            background: #f8d7da; 
            border-color: #dc3545; 
            color: #721c24; 
        }
        .loading {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        pre { 
            background: #2c3e50; 
            color: #ecf0f1;
            padding: 15px; 
            border-radius: 8px; 
            overflow-x: auto; 
            font-size: 0.9em;
            margin: 10px 0;
        }
        .status-bar {
            background: #34495e;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
        .summary {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .summary h3 {
            color: #28a745;
            margin: 0 0 15px 0;
        }
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .test-item:last-child {
            border-bottom: none;
        }
        .test-name {
            font-weight: 600;
        }
        .test-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 600;
        }
        .status-pass { background: #d4edda; color: #155724; }
        .status-fail { background: #f8d7da; color: #721c24; }
        .status-pending { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” LPO API ì¢…í•© í…ŒìŠ¤íŠ¸</h1>
            <p>MOSB Gate Agentì˜ ëª¨ë“  LPO ê´€ë ¨ ê¸°ëŠ¥ì„ ê²€ì¦í•©ë‹ˆë‹¤</p>
        </div>

        <div class="status-bar">
            <div>ì„œë²„ ìƒíƒœ: <span id="serverStatus">í™•ì¸ ì¤‘...</span></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div>ì§„í–‰ë¥ : <span id="progressText">0%</span></div>
        </div>

        <div class="test-grid">
            <div class="test-section">
                <h3>ğŸŒ ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸</h3>
                <button class="test-button" onclick="testBasicConnection()">ì„œë²„ ì—°ê²° í™•ì¸</button>
                <button class="test-button" onclick="testAPIHealth()">API í—¬ìŠ¤ì²´í¬</button>
                <div id="basicResult"></div>
            </div>

            <div class="test-section">
                <h3>ğŸ“ LPO ìœ„ì¹˜ ì¡°íšŒ</h3>
                <button class="test-button" onclick="testValidLPO()">ìœ íš¨í•œ LPO ì¡°íšŒ</button>
                <button class="test-button" onclick="testInvalidLPO()">ì¡´ì¬í•˜ì§€ ì•ŠëŠ” LPO</button>
                <button class="test-button" onclick="testWrongFormat()">ì˜ëª»ëœ í˜•ì‹</button>
                <div id="lpoResult"></div>
            </div>

            <div class="test-section">
                <h3>ğŸ“‹ MOSB ì‹ ì²­ì„œ</h3>
                <button class="test-button" onclick="testApplicationSubmit()">ì‹ ì²­ì„œ ì œì¶œ</button>
                <button class="test-button" onclick="testApplicationList()">ì‹ ì²­ì„œ ëª©ë¡</button>
                <button class="test-button" onclick="testApplicationStatus()">ìƒíƒœ ì¡°íšŒ</button>
                <div id="applicationResult"></div>
            </div>

            <div class="test-section">
                <h3>ğŸ”§ ê³ ê¸‰ ê¸°ëŠ¥</h3>
                <button class="test-button" onclick="testBatchLPO()">ë°°ì¹˜ LPO ì¡°íšŒ</button>
                <button class="test-button" onclick="testStatistics()">í†µê³„ ì •ë³´</button>
                <button class="test-button" onclick="testErrorHandling()">ì—ëŸ¬ ì²˜ë¦¬</button>
                <div id="advancedResult"></div>
            </div>
        </div>

        <div class="summary" id="summary" style="display: none;">
            <h3>ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½</h3>
            <div id="summaryContent"></div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="test-button" onclick="runAllTests()" style="font-size: 1.2em; padding: 15px 30px;">
                ğŸš€ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            </button>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';
        let testResults = {};
        let currentTest = 0;
        const totalTests = 12;

        // ì„œë²„ ìƒíƒœ í™•ì¸
        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_BASE}/test-lpo`);
                if (response.ok) {
                    document.getElementById('serverStatus').textContent = 'âœ… ì—°ê²°ë¨ (í¬íŠ¸ 3001)';
                    document.getElementById('serverStatus').style.color = '#28a745';
                } else {
                    document.getElementById('serverStatus').textContent = 'âŒ ì—°ê²° ì‹¤íŒ¨';
                    document.getElementById('serverStatus').style.color = '#dc3545';
                }
            } catch (error) {
                document.getElementById('serverStatus').textContent = 'âŒ ì„œë²„ ì˜¤í”„ë¼ì¸';
                document.getElementById('serverStatus').style.color = '#dc3545';
            }
        }

        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress() {
            currentTest++;
            const percentage = Math.round((currentTest / totalTests) * 100);
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = percentage + '%';
        }

        // ê²°ê³¼ í‘œì‹œ
        function showResult(containerId, success, title, data) {
            const container = document.getElementById(containerId);
            container.className = `result ${success ? 'success' : 'error'}`;
            container.innerHTML = `
                <h4>${success ? 'âœ…' : 'âŒ'} ${title}</h4>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            updateProgress();
        }

        // ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testBasicConnection() {
            try {
                const response = await fetch(`${API_BASE}/test-lpo`);
                const data = await response.json();
                
                if (response.ok) {
                    showResult('basicResult', true, 'ì„œë²„ ì—°ê²° ì„±ê³µ', data);
                    testResults.basicConnection = 'PASS';
                } else {
                    showResult('basicResult', false, 'ì„œë²„ ì—°ê²° ì‹¤íŒ¨', data);
                    testResults.basicConnection = 'FAIL';
                }
            } catch (error) {
                showResult('basicResult', false, 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜', { error: error.message });
                testResults.basicConnection = 'FAIL';
            }
        }

        // API í—¬ìŠ¤ì²´í¬
        async function testAPIHealth() {
            try {
                const response = await fetch(`${API_BASE}/test-lpo`);
                const data = await response.json();
                
                if (response.ok && data.message) {
                    showResult('basicResult', true, 'API í—¬ìŠ¤ì²´í¬ ì„±ê³µ', data);
                    testResults.apiHealth = 'PASS';
                } else {
                    showResult('basicResult', false, 'API í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨', data);
                    testResults.apiHealth = 'FAIL';
                }
            } catch (error) {
                showResult('basicResult', false, 'API í—¬ìŠ¤ì²´í¬ ì˜¤ë¥˜', { error: error.message });
                testResults.apiHealth = 'FAIL';
            }
        }

        // ìœ íš¨í•œ LPO ì¡°íšŒ
        async function testValidLPO() {
            try {
                const response = await fetch(`${API_BASE}/lpo/location/LPO-2024-001234`);
                const data = await response.json();
                
                if (response.ok && data.lpoNumber) {
                    showResult('lpoResult', true, 'ìœ íš¨í•œ LPO ì¡°íšŒ ì„±ê³µ', data);
                    testResults.validLPO = 'PASS';
                } else {
                    showResult('lpoResult', false, 'ìœ íš¨í•œ LPO ì¡°íšŒ ì‹¤íŒ¨', data);
                    testResults.validLPO = 'FAIL';
                }
            } catch (error) {
                showResult('lpoResult', false, 'LPO ì¡°íšŒ ì˜¤ë¥˜', { error: error.message });
                testResults.validLPO = 'FAIL';
            }
        }

        // ì¡´ì¬í•˜ì§€ ì•ŠëŠ” LPO ì¡°íšŒ
        async function testInvalidLPO() {
            try {
                const response = await fetch(`${API_BASE}/lpo/location/LPO-2024-999999`);
                const data = await response.json();
                
                if (response.status === 404) {
                    showResult('lpoResult', true, 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” LPO - ì˜¬ë°”ë¥¸ 404 ì‘ë‹µ', data);
                    testResults.invalidLPO = 'PASS';
                } else {
                    showResult('lpoResult', false, 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” LPO - ì˜ˆìƒê³¼ ë‹¤ë¥¸ ì‘ë‹µ', data);
                    testResults.invalidLPO = 'FAIL';
                }
            } catch (error) {
                showResult('lpoResult', false, 'LPO ì¡°íšŒ ì˜¤ë¥˜', { error: error.message });
                testResults.invalidLPO = 'FAIL';
            }
        }

        // ì˜ëª»ëœ í˜•ì‹ í…ŒìŠ¤íŠ¸
        async function testWrongFormat() {
            try {
                const response = await fetch(`${API_BASE}/lpo/location/INVALID-FORMAT`);
                const data = await response.json();
                
                if (response.status === 400) {
                    showResult('lpoResult', true, 'ì˜ëª»ëœ í˜•ì‹ - ì˜¬ë°”ë¥¸ 400 ì‘ë‹µ', data);
                    testResults.wrongFormat = 'PASS';
                } else {
                    showResult('lpoResult', false, 'ì˜ëª»ëœ í˜•ì‹ - ì˜ˆìƒê³¼ ë‹¤ë¥¸ ì‘ë‹µ', data);
                    testResults.wrongFormat = 'FAIL';
                }
            } catch (error) {
                showResult('lpoResult', false, 'í˜•ì‹ ê²€ì¦ ì˜¤ë¥˜', { error: error.message });
                testResults.wrongFormat = 'FAIL';
            }
        }

        // ì‹ ì²­ì„œ ì œì¶œ í…ŒìŠ¤íŠ¸
        async function testApplicationSubmit() {
            try {
                const testApplication = {
                    driverName: "í…ŒìŠ¤íŠ¸ ìš´ì „ì",
                    phone: "+971-50-123-4567",
                    company: "í…ŒìŠ¤íŠ¸ íšŒì‚¬",
                    visitDate: "2024-12-25",
                    vehicleType: "íŠ¸ëŸ­",
                    documents: []
                };

                const response = await fetch(`${API_BASE}/mosb/applications`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testApplication)
                });
                
                const data = await response.json();
                
                if (response.ok && data.application) {
                    showResult('applicationResult', true, 'ì‹ ì²­ì„œ ì œì¶œ ì„±ê³µ', data);
                    testResults.applicationSubmit = 'PASS';
                } else {
                    showResult('applicationResult', false, 'ì‹ ì²­ì„œ ì œì¶œ ì‹¤íŒ¨', data);
                    testResults.applicationSubmit = 'FAIL';
                }
            } catch (error) {
                showResult('applicationResult', false, 'ì‹ ì²­ì„œ ì œì¶œ ì˜¤ë¥˜', { error: error.message });
                testResults.applicationSubmit = 'FAIL';
            }
        }

        // ì‹ ì²­ì„œ ëª©ë¡ ì¡°íšŒ
        async function testApplicationList() {
            try {
                const response = await fetch(`${API_BASE}/mosb/applications`);
                const data = await response.json();
                
                if (response.ok) {
                    showResult('applicationResult', true, 'ì‹ ì²­ì„œ ëª©ë¡ ì¡°íšŒ ì„±ê³µ', data);
                    testResults.applicationList = 'PASS';
                } else {
                    showResult('applicationResult', false, 'ì‹ ì²­ì„œ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨', data);
                    testResults.applicationList = 'FAIL';
                }
            } catch (error) {
                showResult('applicationResult', false, 'ì‹ ì²­ì„œ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜', { error: error.message });
                testResults.applicationList = 'FAIL';
            }
        }

        // ì‹ ì²­ì„œ ìƒíƒœ ì¡°íšŒ
        async function testApplicationStatus() {
            try {
                const response = await fetch(`${API_BASE}/mosb/applications/MSB-2024-001234`);
                const data = await response.json();
                
                if (response.ok || response.status === 404) {
                    showResult('applicationResult', true, 'ì‹ ì²­ì„œ ìƒíƒœ ì¡°íšŒ ì„±ê³µ', data);
                    testResults.applicationStatus = 'PASS';
                } else {
                    showResult('applicationResult', false, 'ì‹ ì²­ì„œ ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨', data);
                    testResults.applicationStatus = 'FAIL';
                }
            } catch (error) {
                showResult('applicationResult', false, 'ì‹ ì²­ì„œ ìƒíƒœ ì¡°íšŒ ì˜¤ë¥˜', { error: error.message });
                testResults.applicationStatus = 'FAIL';
            }
        }

        // ë°°ì¹˜ LPO ì¡°íšŒ
        async function testBatchLPO() {
            try {
                const lpoNumbers = ['LPO-2024-001234', 'LPO-2024-001235', 'LPO-2024-999999'];
                const results = {};
                
                for (const lpoNumber of lpoNumbers) {
                    try {
                        const response = await fetch(`${API_BASE}/lpo/location/${lpoNumber}`);
                        const data = await response.json();
                        results[lpoNumber] = response.ok ? data : { error: data.error };
                    } catch (error) {
                        results[lpoNumber] = { error: error.message };
                    }
                }
                
                showResult('advancedResult', true, 'ë°°ì¹˜ LPO ì¡°íšŒ ì™„ë£Œ', results);
                testResults.batchLPO = 'PASS';
            } catch (error) {
                showResult('advancedResult', false, 'ë°°ì¹˜ LPO ì¡°íšŒ ì˜¤ë¥˜', { error: error.message });
                testResults.batchLPO = 'FAIL';
            }
        }

        // í†µê³„ ì •ë³´ ì¡°íšŒ
        async function testStatistics() {
            try {
                const response = await fetch(`${API_BASE}/mosb/applications`);
                const data = await response.json();
                
                if (response.ok) {
                    const applications = data.applications || [];
                    const stats = {
                        totalApplications: applications.length,
                        pendingApplications: applications.filter(app => app.status === 'submitted').length,
                        approvedApplications: applications.filter(app => app.status === 'approved').length,
                        rejectedApplications: applications.filter(app => app.status === 'rejected').length
                    };
                    
                    showResult('advancedResult', true, 'í†µê³„ ì •ë³´ ì¡°íšŒ ì„±ê³µ', stats);
                    testResults.statistics = 'PASS';
                } else {
                    showResult('advancedResult', false, 'í†µê³„ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨', data);
                    testResults.statistics = 'FAIL';
                }
            } catch (error) {
                showResult('advancedResult', false, 'í†µê³„ ì •ë³´ ì¡°íšŒ ì˜¤ë¥˜', { error: error.message });
                testResults.statistics = 'FAIL';
            }
        }

        // ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
        async function testErrorHandling() {
            try {
                // ì˜ëª»ëœ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
                const response = await fetch(`${API_BASE}/invalid-endpoint`);
                
                if (response.status === 404) {
                    showResult('advancedResult', true, 'ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ ì„±ê³µ', { 
                        message: 'ì˜ëª»ëœ ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ ì˜¬ë°”ë¥¸ 404 ì‘ë‹µ',
                        status: response.status 
                    });
                    testResults.errorHandling = 'PASS';
                } else {
                    showResult('advancedResult', false, 'ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨', { 
                        message: 'ì˜ˆìƒê³¼ ë‹¤ë¥¸ ì‘ë‹µ',
                        status: response.status 
                    });
                    testResults.errorHandling = 'FAIL';
                }
            } catch (error) {
                showResult('advancedResult', true, 'ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ ì„±ê³µ', { 
                    message: 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ì— ëŒ€í•œ ì ì ˆí•œ ì²˜ë¦¬',
                    error: error.message 
                });
                testResults.errorHandling = 'PASS';
            }
        }

        // ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function runAllTests() {
            currentTest = 0;
            testResults = {};
            
            // ì§„í–‰ë¥  ì´ˆê¸°í™”
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('progressText').textContent = '0%';
            
            // ëª¨ë“  í…ŒìŠ¤íŠ¸ ìˆœì°¨ ì‹¤í–‰
            await testBasicConnection();
            await testAPIHealth();
            await testValidLPO();
            await testInvalidLPO();
            await testWrongFormat();
            await testApplicationSubmit();
            await testApplicationList();
            await testApplicationStatus();
            await testBatchLPO();
            await testStatistics();
            await testErrorHandling();
            
            // ê²°ê³¼ ìš”ì•½ í‘œì‹œ
            showSummary();
        }

        // ê²°ê³¼ ìš”ì•½ í‘œì‹œ
        function showSummary() {
            const summary = document.getElementById('summary');
            const content = document.getElementById('summaryContent');
            
            const passedTests = Object.values(testResults).filter(result => result === 'PASS').length;
            const totalTests = Object.keys(testResults).length;
            const successRate = Math.round((passedTests / totalTests) * 100);
            
            let summaryHTML = `
                <div style="margin-bottom: 20px;">
                    <h4>ì „ì²´ ê²°ê³¼: ${passedTests}/${totalTests} í…ŒìŠ¤íŠ¸ í†µê³¼ (${successRate}%)</h4>
                </div>
            `;
            
            for (const [testName, result] of Object.entries(testResults)) {
                const statusClass = result === 'PASS' ? 'status-pass' : 'status-fail';
                const statusText = result === 'PASS' ? 'í†µê³¼' : 'ì‹¤íŒ¨';
                
                summaryHTML += `
                    <div class="test-item">
                        <span class="test-name">${getTestDisplayName(testName)}</span>
                        <span class="test-status ${statusClass}">${statusText}</span>
                    </div>
                `;
            }
            
            content.innerHTML = summaryHTML;
            summary.style.display = 'block';
        }

        // í…ŒìŠ¤íŠ¸ ì´ë¦„ ë³€í™˜
        function getTestDisplayName(testName) {
            const names = {
                'basicConnection': 'ì„œë²„ ì—°ê²°',
                'apiHealth': 'API í—¬ìŠ¤ì²´í¬',
                'validLPO': 'ìœ íš¨í•œ LPO ì¡°íšŒ',
                'invalidLPO': 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” LPO',
                'wrongFormat': 'ì˜ëª»ëœ í˜•ì‹ ê²€ì¦',
                'applicationSubmit': 'ì‹ ì²­ì„œ ì œì¶œ',
                'applicationList': 'ì‹ ì²­ì„œ ëª©ë¡',
                'applicationStatus': 'ì‹ ì²­ì„œ ìƒíƒœ',
                'batchLPO': 'ë°°ì¹˜ LPO ì¡°íšŒ',
                'statistics': 'í†µê³„ ì •ë³´',
                'errorHandling': 'ì—ëŸ¬ ì²˜ë¦¬'
            };
            return names[testName] || testName;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„œë²„ ìƒíƒœ í™•ì¸
        window.onload = function() {
            checkServerStatus();
        };
    </script>
</body>
</html> 